<div class="container">
  <div class="header">
    <div class="d-flex align-items-center justify-content-center gap-2">
      <h2 [lang]="languageService.selectedLanguage()">
        {{ 'common.monitor.dashboard.title' | translate }}
      </h2>
      <a [href]="monitoringWikiLink" target="_blank"><i class="bi bi-info-circle"></i></a>
    </div>
    <h3 [lang]="languageService.selectedLanguage()">
      {{ 'common.monitor.dashboard.subtitle' | translate }}
    </h3>
  </div>
  @if (loading) {
    <div class="loading" [lang]="languageService.selectedLanguage()">
      {{ 'common.monitor.dashboard.loading' | translate }}
    </div>
  }

  @if (error) {
    <div class="error">{{ error }}</div>
  }

  @if (!loading && focusedRepo().length) {
    <h4 class="section-title">{{ 'common.monitor.dashboard.focus.title' | translate }}</h4>
    <div class="repo-grid">
      @for (repo of focusedRepo(); track repo.name) {
        <ng-container *ngTemplateOutlet="repoCard; context: { $implicit: repo }"></ng-container>
      }
    </div>
  }

  @if (!loading && standardRepo().length) {
    <h4 class="section-title">{{ 'common.monitor.dashboard.standard.title' | translate }}</h4>
    <div class="repo-grid">
      @for (repo of standardRepo(); track repo.name) {
        <ng-container *ngTemplateOutlet="repoCard; context: { $implicit: repo }"></ng-container>
      }
    </div>
  }

  <ng-template #repoCard let-repo>
    <div class="repo-card d-flex flex-column justify-content-between">
      <div class="repo-card__meta">
        <div class="repo-header">
          <a class="text-decoration-none" [href]="repo.htmlUrl"  target="_blank" rel="noopener noreferrer">
            <p>{{ repo.name }}</p>
          </a>
          <span class="badge">{{ repo.language }}</span>
        </div>
        <div class="repo-info">
          @for (build of repo.testResults; track build.workflow) {
            <span class="icon">{{ build.workflow | workflowIcon }}</span>
            <span class="me-3" (click)="onBadgeClick(repo.name, build.workflow )" style="cursor: pointer;">
              <img  [src]="build.badgeUrl" alt="{{ build.workflow }} Badge for {{ repo.name }}" />
            </span>
            <app-build-badge-tooltip [buildType]="build.workflow"/>
            <div class="sub-status">
              @if(!(build.results | isEmptyObjectPipe)) {
                @for (testStatus of build.results | buildStatusEntries; track testStatus.label) {
                  <span class="fs-5">
                    {{ testStatus.label | translate }}: <b>{{ testStatus.count }}</b> {{ testStatus.icon }}
                  </span>
                }
              } @else {
                <br>
              }
            </div>
          }
        </div>
      </div>
      <p>
        <span class="icon">ðŸ“…</span>
        <span class="last-build">
          {{ 'common.monitor.dashboard.lastUpdated' | translate }}:
          {{ repo.lastUpdated | date: 'medium' }}
        </span>
      </p>
    </div>
  </ng-template>
</div>