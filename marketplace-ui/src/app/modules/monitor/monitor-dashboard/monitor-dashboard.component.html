<div class="container">
  <div class="header">
    <h2 [lang]="languageService.selectedLanguage()">
      {{ 'monitor.dashboard.title' | translate }}
    </h2>
    <h3 [lang]="languageService.selectedLanguage()">
      {{ 'monitor.dashboard.subtitle' | translate }}
    </h3>
    <h3>
      <a class="reload-link" title="Reload data" (click)="onSubmit()" [lang]="languageService.selectedLanguage()">
        {{ 'monitor.dashboard.reloadData' | translate }}
      </a>
    </h3>
  </div>

  @if (!loading && repositories.length) {
  <div class="repo-grid">
    @for (repo of repositories; track $index) {
    <div class="repo-card">
      <div class="repo-header">
        <p>{{ repo.name }}</p>
        <span class="visibility">{{ repo.language }}</span>
      </div>

      <div class="repo-info">
        @if (repo.ciBadgeUrl) {
        <div class="badge-row" (click)="onBadgeClick(repo.name, 'ci')">
          üè∑Ô∏è {{ 'monitor.dashboard.ciLabel' | translate }}: 
          <img [src]="repo.ciBadgeUrl" alt="CI Badge" style="cursor: pointer;" />
        </div>
        <div class="workflow">
          <p class="passed">‚úÖ {{ 'monitor.dashboard.passed' | translate }}: {{ getTotalPassed(repo, 'CI') }}</p>
          <p class="failed">‚ùå {{ 'monitor.dashboard.failed' | translate }}: {{ getTotalFailed(repo, 'CI') }}</p>
          <div class="sub-status">
            {{ 'monitor.dashboard.testCounts.mock' | translate }}
            {{ getTestCount(repo, 'CI', 'MOCK', 'PASSED') }}‚úÖ /
            {{ getTestCount(repo, 'CI', 'MOCK', 'FAILED') }}‚ùå |
            {{ 'monitor.dashboard.testCounts.real' | translate }}
            {{ getTestCount(repo, 'CI', 'REAL', 'PASSED') }}‚úÖ /
            {{ getTestCount(repo, 'CI', 'REAL', 'FAILED') }}‚ùå
          </div>
        </div>
        }

        @if (repo.devBadgeUrl) {
        <div class="badge-row" (click)="onBadgeClick(repo.name, 'dev')">
          üõ†Ô∏è {{ 'monitor.dashboard.devLabel' | translate }}: 
          <img [src]="repo.devBadgeUrl" alt="DEV Badge" style="cursor: pointer;" />
        </div>
        <div class="workflow">
          <p class="passed">‚úÖ {{ 'monitor.dashboard.passed' | translate }}: {{ getTotalPassed(repo, 'DEV') }}</p>
          <p class="failed">‚ùå {{ 'monitor.dashboard.failed' | translate }}: {{ getTotalFailed(repo, 'DEV') }}</p>
          <div class="sub-status">
            {{ 'monitor.dashboard.testCounts.mock' | translate }}
            {{ getTestCount(repo, 'DEV', 'MOCK', 'PASSED') }}‚úÖ /
            {{ getTestCount(repo, 'DEV', 'MOCK', 'FAILED') }}‚ùå |
            {{ 'monitor.dashboard.testCounts.real' | translate }}
            {{ getTestCount(repo, 'DEV', 'REAL', 'PASSED') }}‚úÖ /
            {{ getTestCount(repo, 'DEV', 'REAL', 'FAILED') }}‚ùå
          </div>
        </div>
        }
        
        <p><span class="icon">üìÖ</span>{{ 'monitor.dashboard.lastUpdated' | translate }}: {{ repo.lastUpdated | date:'short' }}</p>
      </div>
    </div>
    }
  </div>
  }

  @if (loading) {
  <div class="loading" [lang]="languageService.selectedLanguage()">
    {{ 'monitor.dashboard.loading' | translate }}
  </div>
  }

  @if (error) {
  <div class="error">{{ error }}</div>
  }
</div>